language: php
php:
  - 7.1

services:
  - docker

env:
  global:
    - DOCKER_DB=database
    - DOCKER_RABBIT=rabbit
    - POSTGRES_DB=test_db
    - POSTGRES_USER=testuser
    - POSTGRES_PASSWORD=testpassword
    - POSTGRES_SCHEME=cinema
    - RABBIT_USER=rabbitmq
    - RABBIT_PASSWORD=rabbitmq
    - RABBIT_GUI_PORT=15672
    - RABBIT_PORT=5672

script:
  - phpunit res/code/src/
  - docker-compose up -d --build
  - docker ps

after_script:
  - docker-compose down

deploy:
  provider: heroku
  app: "lenni-api-simple"
  api_key:
    secure: "ZoNMQDvJkVHb8hKmEAGvZ/aVI7rJORZBLQoaqHRemE4MUAaOkHq/K8bnFhsC1n8/rWGS5Pu5ekOfR+F/KyeR0irlXyNlnD6MfORvIpHeRxU0PP1VOugqnexDdrdrEUP157nWZddwmvc8Q/HAOWWqMpkxgwrFDgfRrzGoHIZeI/GkVCpNsQUbA3hzEyuMpx5GYjPCEYERXLPiSdNSn8uTbt1SCl5lok5zLc1z9h7HYGbWYxTVdeVWcKHL/vTU/QZdvc6lxnH76xOfpsuK84ziFjLbHPjfD45DW9vmMmAc/Y94yB+5rsSMSpeuuS8JfwVV0ACUIoH4MRQK/69gGawtxBDV8G5+Cb6KCusvOH2iSFr/TEgIgVm/fiTCY6L6cHTnPc+fwUyU5K9RYDchfja7ZMh1vNOs2YH+PmbKGRSLeoz+PjQuw4P6MIDAw4NvAAc4A7kyvRaAWaYFOh9tonJOnSw1jXSI1S2ZxDVi301jF3RpTF6a9IPv4Ji56dIZ1BlIiW/H6DZkDHsNunz1hTjkCY9TKLIYMR3wCcfGbPiBsw9zeEzDLrkNTXhd0SWT5f4RWlwWXmUF0FL/N6HHe/DRx/ZcdkO1YCTWgFXSNMZ9E0WbwKGCts8AOLfzAlenot8qeIbnnt9DFbmaqRp+SOTJTkRUEP22qA1IJyLN2UK8NQc="